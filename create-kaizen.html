<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Kaizen - Volvo Group</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .form-container {
            padding: 40px;
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        .required {
            color: #e74c3c;
        }
        input, select, textarea {
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
            margin-right: 15px;
        }
        .btn:hover {
            transform: scale(1.02);
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e1e8ed;
        }
        .error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Create New Kaizen</h1>
            <p>Continuous Improvement Initiative</p>
        </div>

        <div class="form-container">
            <div id="successMessage" class="success" style="display: none;">
                <strong>Success!</strong> Kaizen created successfully. <span id="kaizenNumber"></span>
            </div>

            <form id="kaizenForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="type_name">Type <span class="required">*</span></label>
                        <select id="type_name" name="type_name" required>
                            <option value="">Select Type</option>
                            <option value="Quick">Quick Kaizen</option>
                            <option value="Standard">Standard Kaizen</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="department_name">Department <span class="required">*</span></label>
                        <select id="department_name" name="department_name" required>
                            <option value="">Select Department</option>
                            <option value="Manufacturing">Manufacturing</option>
                            <option value="Quality">Quality</option>
                            <option value="Logistics">Logistics</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Engineering">Engineering</option>
                            <option value="Safety">Safety</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="application_area">Application Area <span class="required">*</span></label>
                        <input type="text" id="application_area" name="application_area" required 
                               placeholder="e.g., Assembly Line A, Warehouse Zone B">
                    </div>

                    <div class="form-group">
                        <label for="leader">Team Leader <span class="required">*</span></label>
                        <input type="text" id="leader" name="leader" required 
                               placeholder="Leader name">
                    </div>

                    <div class="form-group">
                        <label for="team">Team Members</label>
                        <input type="text" id="team" name="team" 
                               placeholder="Team member names (optional)">
                    </div>

                    <div class="form-group">
                        <label for="sqdcep_category">SQDCEP Category <span class="required">*</span></label>
                        <select id="sqdcep_category" name="sqdcep_category" required>
                            <option value="">Select Category</option>
                            <option value="S">Safety (S)</option>
                            <option value="Q">Quality (Q)</option>
                            <option value="D">Delivery (D)</option>
                            <option value="C">Cost (C)</option>
                            <option value="E">Environment (E)</option>
                            <option value="P">People (P)</option>
                        </select>
                    </div>

                    <!-- Common Problem Field -->
                    <div class="form-group full-width">
                        <label for="problem">Problem <span class="required">*</span></label>
                        <textarea id="problem" name="problem" required 
                                  placeholder="Describe the current problem or opportunity for improvement..."></textarea>
                    </div>

                    <!-- Quick Kaizen Fields -->
                    <div id="quickFields" style="display: none;">
                        <div class="form-group full-width">
                            <label for="problem_sketch">Problem Sketch <span class="required">*</span></label>
                            <textarea id="problem_sketch" name="problem_sketch" 
                                      placeholder="Describe current situation in detail..."></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label for="improvement_future_situation">Future Situation <span class="required">*</span></label>
                            <textarea id="improvement_future_situation" name="improvement_future_situation" 
                                      placeholder="Describe the improved future state..."></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label for="check_results">Check Results</label>
                            <textarea id="check_results" name="check_results" 
                                      placeholder="Expected results and verification method..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="cost_summary">Cost Summary</label>
                            <textarea id="cost_summary" name="cost_summary" 
                                      placeholder="Brief cost breakdown..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="benefit_summary">Benefit Summary</label>
                            <textarea id="benefit_summary" name="benefit_summary" 
                                      placeholder="Expected benefits summary..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="cb_ratio_summary">Cost/Benefit Ratio</label>
                            <textarea id="cb_ratio_summary" name="cb_ratio_summary" 
                                      placeholder="ROI calculation..."></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label for="standardization">Standardization</label>
                            <textarea id="standardization" name="standardization" 
                                      placeholder="How will this be standardized?..."></textarea>
                        </div>
                    </div>

                    <!-- Standard Kaizen Fields -->
                    <div id="standardFields" style="display: none;">
                        <div class="form-group full-width">
                            <label for="root_cause_analysis">Root Cause Analysis <span class="required">*</span></label>
                            <textarea id="root_cause_analysis" name="root_cause_analysis" 
                                      placeholder="5-Why analysis, fishbone diagram results..."></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label for="current_state_analysis">Current State Analysis <span class="required">*</span></label>
                            <textarea id="current_state_analysis" name="current_state_analysis" 
                                      placeholder="Detailed analysis of current process..."></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label for="future_state_analysis">Future State Analysis <span class="required">*</span></label>
                            <textarea id="future_state_analysis" name="future_state_analysis" 
                                      placeholder="Detailed description of improved process..."></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label for="picture_of_solution">Picture/Link of Solution</label>
                            <input type="url" id="picture_of_solution" name="picture_of_solution" 
                                   placeholder="https://example.com/solution-image.jpg">
                        </div>

                        <div class="form-group full-width">
                            <label for="monitoring">Monitoring Plan</label>
                            <textarea id="monitoring" name="monitoring" 
                                      placeholder="How will results be monitored and sustained?..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="benefit_detailed">Detailed Benefits</label>
                            <textarea id="benefit_detailed" name="benefit_detailed" 
                                      placeholder="Quantified benefits with calculations..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="cost_detailed">Detailed Costs</label>
                            <textarea id="cost_detailed" name="cost_detailed" 
                                      placeholder="Complete cost breakdown..."></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label for="bc_detailed">Business Case Analysis</label>
                            <textarea id="bc_detailed" name="bc_detailed" 
                                      placeholder="ROI, payback period, NPV analysis..."></textarea>
                        </div>

                        <div class="form-group full-width">
                            <label for="standardization_detailed">Standardization Plan <span class="required">*</span></label>
                            <textarea id="standardization_detailed" name="standardization_detailed" 
                                      placeholder="Detailed standardization and training plan..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <a href="/" class="btn btn-secondary">‚Üê Back to Dashboard</a>
                    <div>
                        <button type="submit" class="btn" id="submitBtn">
                            Create Kaizen
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Toggle fields based on kaizen type
        document.getElementById('type_name').addEventListener('change', function() {
            const type = this.value;
            const quickFields = document.getElementById('quickFields');
            const standardFields = document.getElementById('standardFields');
            
            if (type === 'Quick') {
                quickFields.style.display = 'block';
                standardFields.style.display = 'none';
                
                // Set required fields for Quick
                document.getElementById('problem_sketch').required = true;
                document.getElementById('improvement_future_situation').required = true;
                
                // Remove required from Standard fields
                document.getElementById('root_cause_analysis').required = false;
                document.getElementById('current_state_analysis').required = false;
                document.getElementById('future_state_analysis').required = false;
                document.getElementById('standardization_detailed').required = false;
                
            } else if (type === 'Standard') {
                quickFields.style.display = 'none';
                standardFields.style.display = 'block';
                
                // Remove required from Quick fields
                document.getElementById('problem_sketch').required = false;
                document.getElementById('improvement_future_situation').required = false;
                
                // Set required fields for Standard
                document.getElementById('root_cause_analysis').required = true;
                document.getElementById('current_state_analysis').required = true;
                document.getElementById('future_state_analysis').required = true;
                document.getElementById('standardization_detailed').required = true;
                
            } else {
                quickFields.style.display = 'none';
                standardFields.style.display = 'none';
            }
        });

        document.getElementById('kaizenForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating...';
            
            try {
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData.entries());
                
                // Remove empty fields to avoid sending unnecessary data
                Object.keys(data).forEach(key => {
                    if (data[key] === '') {
                        delete data[key];
                    }
                });
                
                // Convert numbers (legacy fields, keeping for compatibility)
                if (data.cost) data.cost = parseFloat(data.cost);
                if (data.benefit) data.benefit = parseFloat(data.benefit);
                
                const response = await fetch('https://kaizen-bba6guhvhhdxf2ba.swedencentral-01.azurewebsites.net/api/kaizens', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('kaizenNumber').textContent = `Kaizen Number: ${result.kaizen_number}`;
                    document.getElementById('kaizenForm').reset();
                    
                    // Scroll to success message
                    document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });
                    
                    // Auto redirect after 3 seconds
                    setTimeout(() => {
                        window.location.href = '/kaizen-list.html';
                    }, 3000);
                } else {
                    throw new Error(result.error || 'Failed to create kaizen');
                }
                
            } catch (error) {
                alert('Error creating kaizen: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        });
    </script>
</body>
</html>